\documentclass[12pt]{article}
\usepackage[letterpaper, margin=1in, headheight=105pt]{geometry}
\usepackage{subcaption}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{scalerel}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{comment}
\usepackage{minted}
\usemintedstyle{manni}

\DeclareMathOperator*{\Odot}{\scalerel*{\odot}{\sum}}

\begin{document}
\setcounter{section}{1}
\tableofcontents
\newpage
\begin{comment}
\section{Homework \thesection\ Report}

\newpage
\subsection{Layers}
\begin{scriptsize}
\inputminted[frame=single,framesep=10pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=\parindent]{python}{./Homework1/code/layers.py}
\end{scriptsize}


\newpage
\subsection{Logistic}
\subsubsection{Implementation}
\begin{scriptsize}
\inputminted[frame=single,framesep=10pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=\parindent]{python}{./Homework1/code/logistic.py}
\end{scriptsize}

\newpage
\subsubsection{Simple logistic classifier}
\inputminted[frame=single,framesep=10pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=\parindent]{python}{./Homework1/code/logistic1.out}

\newpage
\subsubsection{2-layer neural network with logistic regression}
\inputminted[frame=single,framesep=10pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=\parindent]{python}{./Homework1/code/logistic2.out}


\newpage
\subsection{Support vector machine}
\subsubsection{Implementation}
\begin{scriptsize}
\inputminted[frame=single,framesep=10pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=\parindent]{python}{./Homework1/code/svm.py}
\end{scriptsize}

\newpage
\subsubsection{Binary SVM classifier}
\inputminted[frame=single,framesep=10pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=\parindent]{python}{./Homework1/code/svm1.out}

\newpage
\subsubsection{2-lay neural network with hinge loss}
\inputminted[frame=single,framesep=10pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=\parindent]{python}{./Homework1/code/svm2.out}

\newpage
\subsection{Softmax}
\subsubsection{Implementation}
\begin{scriptsize}
\inputminted[frame=single,framesep=10pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=\parindent]{python}{./Homework1/code/softmax.py}
\end{scriptsize}

\newpage
\subsubsection{Softmax multi-class classifier}
\inputminted[frame=single,framesep=10pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=\parindent]{python}{./Homework1/code/softmax1.out}

\newpage
\subsubsection{2-layer neural network with softmax loss}
\inputminted[frame=single,framesep=10pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=\parindent]{python}{./Homework1/code/softmax2.out}

\newpage
\subsection{Convolutional neural network}
\subsubsection{Implementation}
\begin{scriptsize}
\inputminted[frame=single,framesep=10pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=\parindent]{python}{./Homework1/code/cnn.py}
\end{scriptsize}


\subsubsection{CNN multi-class classifier}
I am not able to train CNN.

\newpage
\subsection{Convolutional neural network}
\subsubsection{Implementation}
\begin{scriptsize}
\inputminted[frame=single,framesep=10pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=\parindent]{python}{./Homework1/code/vgg.py}
\end{scriptsize}

\newpage
\subsubsection{Test}
\inputminted[frame=single,framesep=10pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=\parindent]{python}{./Homework1/code/vgg.out}
\subsubsection{Different optimizer}
The accuracy does not significantly improve by changing the optimizer and learning rate strategy.


\newpage
\subsection{Short answer questions}

\subsubsection{Sigmoid non-linearity}
Sigmoid brings issues when the number of layers increases because the derivative terms that are less than 1 will be multiplied each other many times that the values will become smaller and smaller until the gradient will vanish.

\subsubsection{Training loss}
I may decrease the learning rate.
\end{comment}


\section{Homework \thesection\ Report}
\subsection{Transfer learning}
\begin{scriptsize}
    \inputminted[frame=single,framesep=9pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=5pt]{python}{./Homework2/code/transfer_learning.py}
\end{scriptsize}
\begin{figure}[htbp]
    \centering
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.8]{./Homework2/output/hw2p1_fig01.png}
        \caption{Finrtune}
    \label{hw2p1a}
    \end{subfigure}\\
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.8]{./Homework2/output/hw2p1_fig02.png}
        \caption{Freeze}
    \label{hw2p1b}
    \end{subfigure}
    \caption{Transfer learning}
\end{figure}

\newpage
\subsection{Style Transfer}
\begin{scriptsize}
    \inputminted[frame=single,framesep=9pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=\parindent]{python}{./Homework2/code/style_transfer.py}
\end{scriptsize}
\begin{figure}[htbp]
    \centering
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 1in 3in 2in},scale=0.8]{./Homework2/output/hw2p2_fig01.png}
        \caption{Content and Source}
    \label{hw2p2a}
    \end{subfigure}\\
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p2_fig02.png}
        \caption{Iteration 0}
    \label{hw2p2b}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p2_fig03.png}
        \caption{Iteration 100}
    \label{hw2p2c}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p2_fig04.png}
        \caption{Iteration 200}
    \label{hw2p2d}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p2_fig13.png}
        \caption{Learning curve}
    \label{hw2p2e}
    \end{subfigure}
    \caption{Style transfer for Tubingen \& Composition VII}
\end{figure}


\begin{figure}[htbp]
    \centering
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 1in 3in 1in},scale=0.8]{./Homework2/output/hw2p2_fig05.png}
        \caption{Content and Source}
    \label{hw2p2f}
    \end{subfigure}\\
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p2_fig06.png}
        \caption{Iteration 0}
    \label{hw2p2g}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p2_fig07.png}
        \caption{Iteration 100}
    \label{hw2p2h}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p2_fig08.png}
        \caption{Iteration 200}
    \label{hw2p2i}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p2_fig14.png}
        \caption{Learning curve}
    \label{hw2p2j}
    \end{subfigure}
    \caption{Style transfer for Tubingen \& The Scream}
\end{figure}


\begin{figure}[htbp]
    \centering
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 1in 3in 1in},scale=0.8]{./Homework2/output/hw2p2_fig09.png}
        \caption{Content and Source}
    \label{hw2p2k}
    \end{subfigure}\\
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p2_fig10.png}
        \caption{Iteration 0}
    \label{hw2p2l}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p2_fig11.png}
        \caption{Iteration 100}
    \label{hw2p2m}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p2_fig12.png}
        \caption{Iteration 200}
    \label{hw2p2n}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p2_fig15.png}
        \caption{Learning curve}
    \label{hw2p2o}
    \end{subfigure}
    \caption{Style transfer for Tubingen \& Starry Night}
\end{figure}

\newpage
\subsection{Forward and Backward propagation module for RNN}
Here we adopt the notation \(\odot\) as element-wise multiplication, and the matrix multiplications are abbreviated.
Also, we derive the mathematical notation (vectors are columes) instead of the notation in code.

\setcounter{subsubsection}{1}
\subsubsection{RNN step backward}
We observe that \(\frac{\partial \tanh\theta}{\partial\theta}=1-\tanh^2\theta\), so by chain rule, we have
\begin{align*}
    \frac{\partial L}{\partial x_t}&= W_x^\mathrm{T}\left[\frac{\partial L}{\partial h_t}\odot (1-h_t^2) \right]\\
    \frac{\partial L}{\partial W_t}&= \left[\frac{\partial L}{\partial h_t}\odot (1-h_t^2) \right]x_t^\mathrm{T}\\
    \frac{\partial L}{\partial h_{t-1}}&= W_h^\mathrm{T}\left[\frac{\partial L}{\partial h_t}\odot (1-h_t^2) \right]\\
    \frac{\partial L}{\partial W_h}&= \left[\frac{\partial L}{\partial h_t}\odot (1-h_t^2) \right]h_{t-1}^\mathrm{T}\\
    \frac{\partial L}{\partial b}&= \left[\frac{\partial L}{\partial h_t}\odot (1-h_t^2) \right]
\end{align*}

\setcounter{subsubsection}{3}
\subsubsection{RNN step backward total}
\begin{align*}
    \frac{\partial L}{\partial x_t}&=\left[W_x^\mathrm{T}(1-h_t^2)\right]\odot
        \sum_{i=0}^{T-t}\left[\left(W_h^\mathrm{T}\right)^{T-t-i}\frac{\partial L}{\partial h_{T-i}}\Odot_{j=i}^{T-t-1}\left(1-h_{T-j}^2 \right) \right]\\
    \frac{\partial L}{\partial W_x}&=\sum_{t=1}^{T}
        \left\{(1-h_t^2)\odot \sum_{i=0}^{T-t}
        \left[\left(W_h^\mathrm{T}\right)^{T-t-i}\frac{\partial L}{\partial h_{T-i}}
        \Odot_{j=i}^{T-t-1}\left(1-h_{T-j}^2 \right) \right]\right\}x_t^{\mathrm{T}}\\
    \frac{\partial L}{\partial h_0}&=\left[W_h^\mathrm{T}(1-h_1^2)\right]\odot
        \sum_{i=0}^{T-1}\left[\left(W_h^\mathrm{T}\right)^{T-1-i}\frac{\partial L}{\partial h_{T-i}}\Odot_{j=i}^{T-2}\left(1-h_{T-j}^2 \right) \right]\\
    \frac{\partial L}{\partial W_h}&=\sum_{t=1}^{T}
        \left\{(1-h_t^2)\odot \sum_{i=0}^{T-t}
        \left[\left(W_h^\mathrm{T}\right)^{T-t-i}\frac{\partial L}{\partial h_{T-i}}
        \Odot_{j=i}^{T-t-1}\left(1-h_{T-j}^2 \right) \right]\right\}h_{t-1}^{\mathrm{T}}\\
    \frac{\partial L}{\partial b}&=\sum_{t=1}^{T}
        \left\{(1-h_t^2)\odot \sum_{i=0}^{T-t}
        \left[\left(W_h^\mathrm{T}\right)^{T-t-i}\frac{\partial L}{\partial h_{T-i}}
        \Odot_{j=i}^{T-t-1}\left(1-h_{T-j}^2 \right) \right]\right\}
\end{align*}

\subsection{Forward and Backward propagation module for LSTM}



\newpage
\subsection{Application to Image Captioning}
\begin{figure}[htbp]
    \centering
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 1in},scale=0.7]{./Homework2/output/hw2p5_fig01.png}
        \caption{Learning curve}
    \label{hw2p5a}
    \end{subfigure}\\
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p5_fig02.png}
        \caption{Train}
    \label{hw2p5b}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p5_fig03.png}
        \caption{Train}
    \label{hw2p5c}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p5_fig04.png}
        \caption{Val}
    \label{hw2p5d}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p5_fig05.png}
        \caption{Val}
    \label{hw2p5e}
    \end{subfigure}
    \caption{Image captioning RNN}
\end{figure}
\begin{figure}[htbp]
    \centering
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 1in},scale=0.7]{./Homework2/output/hw2p5_fig06.png}
        \caption{Learning curve}
    \label{hw2p5f}
    \end{subfigure}\\
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p5_fig07.png}
        \caption{Train}
    \label{hw2p5g}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p5_fig08.png}
        \caption{Train}
    \label{hw2p5h}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p5_fig09.png}
        \caption{Val}
    \label{hw2p5i}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\textwidth}
        \centering
        \includegraphics[trim={3in 0in 3in 0in},scale=0.5]{./Homework2/output/hw2p5_fig10.png}
        \caption{Val}
    \label{hw2p5j}
    \end{subfigure}
    \caption{Image captioning RNN}
\end{figure}

\newpage
\subsection{Application to text classification}
\begin{itemize}
    \item{BOW} 94.98\%
    \item{AvgPool} 95.15\%
    \item{GloVe} 95.51\%
    \item{RNN} 94.89\%
    \item{LSTM} 96.70\%
\end{itemize}
\inputminted[frame=single,framesep=10pt,linenos, breaklines,xleftmargin=\parindent,xrightmargin=\parindent]{python}{./Homework2/output/hw2p6.txt}
\end{document}